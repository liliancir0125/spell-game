<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è‹±æ–‡æ‹¼å­—éŠæˆ² Ver 3.3.0</title>
    <style>
        :root { --pink: #FFD1DC; --blue: #BFEAF2; --yellow: #FFF4BD; --text: #5d4037; --bg: #FFFBFA; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: sans-serif; }
        body { margin: 0; padding: 0; background-color: var(--bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* å°è¦½åˆ— */
        .nav-header {
            width: 100%; background: white; padding: 10px 15px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 3px solid var(--pink); flex-shrink: 0;
        }
        .btn-home {
            text-decoration: none; background: var(--yellow); padding: 8px 16px;
            border-radius: 20px; font-weight: bold; border: 2px solid var(--text); color: var(--text);
        }
        .current-level-tag { font-weight: bold; color: var(--text); font-size: 1rem; }

        /* ä¸»èˆå° */
        #main-container { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 10px; }
        h1 { font-size: 2.2rem; color: var(--text); margin: 0 0 20px 0; text-shadow: 2px 2px 0 var(--pink); }

        /* é¸é—œç•«é¢ (éš±è—æ™‚ display: none) */
        .menu-overlay { display: flex; flex-direction: column; align-items: center; gap: 20px; width: 100%; }
        .grade-btns { display: flex; gap: 20px; }
        .btn-grade { 
            padding: 20px 40px; font-size: 1.5rem; font-weight: bold; border-radius: 15px;
            border: 3px solid var(--text); background: white; cursor: pointer;
        }
        .btn-grade.active { background: var(--blue); }

        .unit-grid { 
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; 
            width: 100%; max-width: 500px;
        }
        .btn-unit {
            padding: 15px 5px; background: white; border: 2.5px solid var(--pink);
            border-radius: 10px; font-weight: bold; cursor: pointer; text-align: center;
        }

        /* éŠæˆ²ç•«é¢ (éš±è—æ™‚ display: none) */
        #game-stage { display: none; flex-direction: column; align-items: center; width: 100%; }
        .word-card {
            background: white; border: 6px solid var(--yellow); border-radius: 25px;
            padding: 20px; width: 100%; max-width: 350px; text-align: center;
            box-shadow: 0 6px 0 var(--yellow); margin-bottom: 20px;
        }
        #ch-hint { font-size: 1.5rem; font-weight: bold; color: var(--text); margin-bottom: 10px; }
        #word-display { font-size: 2.5rem; font-weight: bold; letter-spacing: 4px; color: var(--pink); min-height: 3.5rem; }

        .keyboard { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; width: 100%; max-width: 500px; }
        .key {
            background: white; border: 2px solid var(--blue); border-radius: 10px;
            padding: 12px 0; font-size: 1.2rem; font-weight: bold; color: var(--text);
            box-shadow: 0 3px 0 var(--blue); cursor: pointer; text-align: center;
        }
        .key.back { background: var(--pink); border-color: #ffb8d1; color: white; }

        .btn-reselect { margin-top: 15px; background: none; border: none; color: #999; text-decoration: underline; cursor: pointer; }

        .version-tag { position: fixed; bottom: 5px; right: 10px; font-size: 10px; opacity: 0.4; }
    </style>
</head>
<body>

    <div class="nav-header">
        <a href="https://liliancir0125.github.io/Rumi_Study_Hall/" class="btn-home">ğŸ  å›å¤§å»³</a>
        <div id="level-display" class="current-level-tag">è«‹é¸æ“‡é—œå¡</div>
    </div>

    <div id="main-container">
        <h1>è‹±æ–‡æ‹¼å­—éŠæˆ²</h1>

        <div id="grade-menu" class="menu-overlay">
            <div class="grade-btns">
                <button class="btn-grade" onclick="selectGrade('G1')">G1</button>
                <button class="btn-grade" onclick="selectGrade('G2')">G2</button>
            </div>
        </div>

        <div id="unit-menu" class="menu-overlay" style="display:none;">
            <div class="unit-grid" id="unit-buttons"></div>
            <button class="btn-reselect" onclick="resetMenu()">â† é‡é¸å¹´ç´š</button>
        </div>

        <div id="game-stage">
            <div class="word-card">
                <div id="ch-hint">è¼‰å…¥ä¸­...</div>
                <div id="word-display"></div>
            </div>
            <div class="keyboard" id="kbd"></div>
            <button class="btn-reselect" onclick="resetMenu()">â† é‡æ–°é¸é—œ</button>
        </div>
    </div>

    <div class="version-tag">Ver. 3.3.0</div>

    <script>
        // æ ¸å¿ƒå–®å­—åº« (è«‹ç¶­æŒä½  3.1.2 çš„å®Œæ•´æ¸…å–®)
        const wordData = {
            "G1-U1": [{en:"CAT", ch:"è²“"}, {en:"ANT", ch:"èèŸ»"}],
            "G1-U2": [{en:"DOG", ch:"ç‹—"}, {en:"BOX", ch:"ç›’å­"}],
            "G2-U1": [{en:"APPLE", ch:"è˜‹æœ"}, {en:"BIRD", ch:"é³¥"}]
        };

        let selGrade = "", selUnit = "", currentWord = {}, userInput = "";

        function selectGrade(g) {
            selGrade = g;
            document.getElementById('grade-menu').style.display = 'none';
            document.getElementById('unit-menu').style.display = 'flex';
            const container = document.getElementById('unit-buttons');
            container.innerHTML = "";
            for(let i=1; i<=10; i++){
                const b = document.createElement('button');
                b.className = 'btn-unit'; b.innerText = "U" + i;
                b.onclick = () => startGame(i);
                container.appendChild(b);
            }
        }

        function startGame(u) {
            selUnit = "U" + u;
            document.getElementById('unit-menu').style.display = 'none';
            document.getElementById('game-stage').style.display = 'flex';
            document.getElementById('level-display').innerText = `${selGrade} - ${selUnit}`;
            initWord();
        }

        function resetMenu() {
            selGrade = ""; selUnit = "";
            document.getElementById('grade-menu').style.display = 'flex';
            document.getElementById('unit-menu').style.display = 'none';
            document.getElementById('game-stage').style.display = 'none';
            document.getElementById('level-display').innerText = "è«‹é¸æ“‡é—œå¡";
        }

        function initWord() {
            const list = wordData[`${selGrade}-${selUnit}`] || [{en:"EMPTY", ch:"å°šæœªè¼¸å…¥"}];
            currentWord = list[Math.floor(Math.random() * list.length)];
            userInput = ""; render();
            if(currentWord.en !== "EMPTY") speak(currentWord.en);
        }

        function render() {
            document.getElementById('ch-hint').innerText = currentWord.ch;
            let d = ""; for(let i=0; i<currentWord.en.length; i++) d += (userInput[i] || "_") + " ";
            document.getElementById('word-display').innerText = d;
            if(userInput === currentWord.en && userInput !== "") {
                setTimeout(() => { alert("â­ ç­”å°äº†ï¼"); initWord(); }, 300);
            }
        }

        function pressKey(l) { if(userInput.length < currentWord.en.length){ userInput += l; speak(l); render(); } }
        function backspace() { userInput = userInput.slice(0, -1); render(); }
        function speak(t) { const ut = new SpeechSynthesisUtterance(t); ut.lang = 'en-US'; window.speechSynthesis.speak(ut); }

        // å»ºç«‹éµç›¤
        const kbd = document.getElementById('kbd');
        "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(l => {
            const b = document.createElement('div'); b.className = 'key'; b.innerText = l;
            b.onclick = () => pressKey(l); kbd.appendChild(b);
        });
        const del = document.createElement('div'); del.className = 'key back'; del.innerText = "â†";
        del.onclick = backspace; kbd.appendChild(del);
    </script>
</body>
</html>
