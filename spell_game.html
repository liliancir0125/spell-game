<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°æ€ªç¸è‹±æ–‡è½å¯«æ©Ÿ - æœ€ç©©å›ºéœæ…‹æŒ‰éˆ•ç‰ˆ</title>
    <style>
        /* ------------------- CSS æ¨£å¼ (èˆ‡å‰ä¸€å€‹ç‰ˆæœ¬ç›¸åŒ) ------------------- */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f7f7e9;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 50px;
            color: #333;
        }

        #game-container {
            width: 90%;
            max-width: 650px;
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            text-align: center;
        }

        /* é¸æ“‡ä»‹é¢ */
        #selection-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        #grade-buttons-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        #unit-buttons-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
            min-height: 50px;
        }

        /* çµ±ä¸€çš„æŒ‰éˆ•æ¨£å¼ */
        .unit-btn {
            padding: 8px 15px;
            font-size: 16px;
            border: 2px solid #ccc;
            border-radius: 8px;
            cursor: pointer;
            background-color: #f0f0f0;
            transition: all 0.1s;
        }
        
        .grade-btn { 
            padding: 10px 25px;
            font-size: 18px;
            font-weight: bold;
        }

        .unit-btn.selected {
            background-color: #4a90e2; 
            color: white;
            border-color: #4a90e2;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        /* éŠæˆ²ç‹€æ…‹é¡¯ç¤º */
        #review-status {
            font-size: 18px;
            color: #d9534f;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        #hint-display {
            font-size: 24px;
            font-weight: bold;
            color: #4a90e2;
            margin-bottom: 20px;
            min-height: 30px;
        }

        #input-area {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .letter-slot {
            width: 45px;
            height: 55px;
            line-height: 55px;
            font-size: 32px;
            font-weight: bold;
            border: 3px solid #ccc;
            border-radius: 8px;
            background-color: #fff;
            color: #333;
        }

        /* éµç›¤èˆ‡æ§åˆ¶æŒ‰éˆ• */
        #keyboard {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 20px;
        }

        .key {
            background-color: #ff99aa;
            color: white;
            border: none;
            padding: 12px 0;
            font-size: 22px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.1s;
        }

        .key:active {
            background-color: #ff6688;
        }

        #control-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }

        .control-btn {
            padding: 12px 25px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 4px #999;
            transition: all 0.1s;
        }

        .control-btn:active {
            box-shadow: 0 0 #999;
            transform: translateY(4px);
        }

        #repeat-btn {
            background-color: #5cb85c;
            color: white;
        }

        #check-btn {
            background-color: #f0ad4e;
            color: white;
        }
        
        #answer-btn {
            background-color: #5bc0de;
            color: white;
        }

        /* åé¥‹æ•ˆæœ */
        .correct {
            background-color: #aaffaa !important;
            border-color: #4CAF50 !important;
        }

        .incorrect {
            background-color: #ffaaaa !important;
            border-color: #f44336 !important;
        }

        .skipped {
            background-color: #ffe4b2 !important; 
            border-color: #ff8c00 !important;
        }

        #feedback-message {
            font-size: 28px;
            font-weight: bold;
            min-height: 30px;
            margin-top: 15px;
            color: #4a90e2;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <h2>å°æ€ªç¸è‹±æ–‡è½å¯«æ©Ÿ âœï¸</h2>
        
        <div id="review-status"></div>

        <div id="selection-controls">
            <div id="grade-buttons-container">
                <button class="grade-btn unit-btn" data-grade="G1" onclick="selectGrade(this)">G1</button>
                <button class="grade-btn unit-btn" data-grade="G2" onclick="selectGrade(this)">G2</button>
            </div>

            <div id="unit-buttons-container">
                è«‹å…ˆé¸æ“‡å¹´ç´š
            </div>
        </div>

        <div id="hint-display">è«‹å…ˆé¸æ“‡å¹´ç´šå’Œå–®å…ƒæŒ‰éˆ•ï¼Œç„¶å¾Œé»æ“Šé–‹å§‹ï¼</div>
        
        <div id="input-area"></div>

        <div id="control-buttons">
            <button id="start-btn" class="control-btn" onclick="startGame()" disabled>é–‹å§‹éŠæˆ² / ä¸‹ä¸€å€‹</button>
            <button id="repeat-btn" class="control-btn" disabled>ğŸ”ˆ é‡è¤‡å”¸ä¸€æ¬¡</button>
            <button id="check-btn" class="control-btn" disabled>âœ… æª¢æŸ¥æ‹¼å¯«</button>
            <button id="answer-btn" class="control-btn" onclick="showAnswer()" disabled>ğŸ“– çœ‹è§£ç­”</button>
        </div>

        <div id="feedback-message"></div>

        <div id="keyboard"></div>
    </div>

    <script>
        // ------------------- JavaScript é‚è¼¯ (ç°¡åŒ–åˆå§‹åŒ–) -------------------

        // 1. å®Œæ•´çš„å–®å­—åº« 
        const allWordUnits = {
            "G1": {
                "U1": [{ word: "HEIS", hint: "ä»–æ˜¯/å¥¹å€‘æ˜¯ (he is)" }, { word: "IAM", hint: "æˆ‘æ˜¯ (I am)" }, { word: "NAME", hint: "åå­—" }, { word: "SHEIS", hint: "å¥¹æ˜¯ (she is)" }, { word: "THE", hint: "é€™å€‹/é‚£å€‹" }, { word: "THIS", hint: "é€™å€‹" }, { word: "YOUARE", hint: "ä½ æ˜¯/æ‚¨æ˜¯ (you are)" }, { word: "WHAT", hint: "ä»€éº¼" }],
                "U2": [{ word: "THAT", hint: "é‚£å€‹" }, { word: "AND", hint: "å’Œ" }, { word: "OUR", hint: "æˆ‘å€‘çš„" }, { word: "HER", hint: "å¥¹çš„" }, { word: "HIS", hint: "ä»–çš„" }, { word: "MY", hint: "æˆ‘çš„" }, { word: "OPEN", hint: "æ‰“é–‹" }, { word: "YOUR", hint: "ä½ çš„" }, { word: "THEY", hint: "ä»–å€‘/å¥¹å€‘" }, { word: "CLOSE", hint: "é—œé–‰" }, { word: "WE", hint: "æˆ‘å€‘" }, { word: "THEIR", hint: "ä»–å€‘çš„" }],
                "U3": [{ word: "SCHOOL", hint: "å­¸æ ¡" }, { word: "GOOD", hint: "å¥½çš„/æ£’çš„" }, { word: "GRADE", hint: "å¹´ç´š/åˆ†æ•¸" }, { word: "HELLO", hint: "ä½ å¥½" }, { word: "IN", hint: "åœ¨...è£¡é¢" }, { word: "NO", hint: "ä¸" }, { word: "NOT", hint: "ä¸" }, { word: "FIRST", hint: "ç¬¬ä¸€" }, { word: "TOO", hint: "ä¹Ÿ" }, { word: "WHO", hint: "èª°" }, { word: "YES", hint: "æ˜¯çš„" }],
                "U4": [{ word: "WHITE", hint: "ç™½è‰²" }, { word: "ORANGE", hint: "æ©˜è‰²" }, { word: "BLACK", hint: "é»‘è‰²" }, { word: "GREEN", hint: "ç¶ è‰²" }, { word: "YELLOW", hint: "é»ƒè‰²" }, { word: "BLUE", hint: "è—è‰²" }, { word: "COLOR", hint: "é¡è‰²" }, { word: "PINK", hint: "ç²‰ç´…è‰²" }, { word: "RED", hint: "ç´…è‰²" }, { word: "WHOSE", hint: "èª°çš„" }],
                "U5": [{ word: "WHERE", hint: "åœ¨å“ªè£¡" }, { word: "GROUP", hint: "å°çµ„" }, { word: "THEREIS", hint: "æœ‰ (å–®æ•¸)" }, { word: "CLASSROOM", hint: "æ•™å®¤" }, { word: "IT", hint: "å®ƒ" }, { word: "THEREARE", hint: "æœ‰ (è¤‡æ•¸)" }, { word: "TELL", hint: "å‘Šè¨´" }, { word: "AT", hint: "åœ¨" }, { word: "GO", hint: "å»" }, { word: "ON", hint: "åœ¨...ä¸Šé¢" }],
                "U6": [{ word: "DRAW", hint: "ç•«ç•«" }, { word: "READ", hint: "é–±è®€" }, { word: "COUNT", hint: "æ•¸æ•¸" }, { word: "WRITE", hint: "å¯«" }, { word: "CAN", hint: "å¯ä»¥" }, { word: "CANT", hint: "ä¸èƒ½ (can't)" }, { word: "CANNOT", hint: "ä¸èƒ½" }, { word: "EAT", hint: "åƒ" }, { word: "RUN", hint: "è·‘" }, { word: "SLEEP", hint: "ç¡è¦º" }],
                "U7": [{ word: "THESE", hint: "é€™äº›" }, { word: "THOSE", hint: "é‚£äº›" }, { word: "COMETO", hint: "ä¾†åˆ° (come to)" }, { word: "TWO", hint: "äºŒ" }, { word: "WALKTO", hint: "èµ°å‘ (walk to)" }, { word: "BYBUS", hint: "æ­å…¬è»Š" }, { word: "FOUR", hint: "å››" }, { word: "HOW", hint: "å¦‚ä½•/æ€éº¼æ¨£" }, { word: "ONE", hint: "ä¸€" }, { word: "THREE", hint: "ä¸‰" }],
                "U8": [{ word: "DOES", hint: "åš (å–®æ•¸ç¬¬ä¸‰äººç¨±)" }, { word: "HOMEWORK", hint: "å®¶åº­ä½œæ¥­" }, { word: "DOESNT", hint: "ä¸åš (doesn't)" }, { word: "KNOW", hint: "çŸ¥é“" }, { word: "WITH", hint: "èˆ‡...ä¸€èµ·" }, { word: "DONT", hint: "ä¸åš (don't)" }, { word: "KICK", hint: "è¸¢" }, { word: "LETS", hint: "è®“æˆ‘å€‘ (let's)" }, { word: "WANTTO", hint: "æƒ³è¦ (want to)" }, { word: "JUMP", hint: "è·³" }, { word: "DO", hint: "åš (å‹•è©)" }, { word: "PLAY", hint: "ç©" }],
                "U9": [{ word: "EIGHT", hint: "å…«" }, { word: "ELEVEN", hint: "åä¸€" }, { word: "WHATTIME", hint: "ä»€éº¼æ™‚é–“ (what time)" }, { word: "TWELVE", hint: "åäºŒ" }, { word: "FIVE", hint: "äº”" }, { word: "FOR", hint: "ç‚ºäº†" }, { word: "NINE", hint: "ä¹" }, { word: "SEVEN", hint: "ä¸ƒ" }, { word: "SIX", hint: "å…­" }, { word: "TEN", hint: "å" }],
                "U10": [{ word: "WINDY", hint: "å¤šé¢¨çš„" }, { word: "DRY", hint: "ä¹¾ç‡¥çš„" }, { word: "WARM", hint: "æº«æš–çš„" }, { word: "RAINY", hint: "ä¸‹é›¨çš„" }, { word: "COLD", hint: "å¯’å†·çš„" }, { word: "HOT", hint: "ç‚ç†±çš„" }, { word: "OR", hint: "æˆ–è€…" }, { word: "SUNNY", hint: "æ™´æœ—çš„" }, { word: "TODAY", hint: "ä»Šå¤©" }, { word: "WET", hint: "æ½®æ¿•çš„" }]
            },
            "G2": {
                "U1": [{ word: "ARM", hint: "æ‰‹è‡‚" }, { word: "BACK", hint: "èƒŒéƒ¨" }, { word: "BODY", hint: "èº«é«”" }, { word: "FEET", hint: "è…³ (è¤‡æ•¸)" }, { word: "FINGER", hint: "æ‰‹æŒ‡" }, { word: "FOOT", hint: "è…³ (å–®æ•¸)" }, { word: "HAND", hint: "æ‰‹" }, { word: "HAS", hint: "æœ‰ (å–®æ•¸ç¬¬ä¸‰äººç¨±)" }, { word: "HAVE", hint: "æœ‰ (å‹•è©)" }, { word: "LEG", hint: "è…¿" }, { word: "THUMB", hint: "æ‹‡æŒ‡" }, { word: "TOE", hint: "è…³è¶¾" }],
                "U2": [{ word: "BIG", hint: "å¤§çš„" }, { word: "EAR", hint: "è€³æœµ" }, { word: "EYE", hint: "çœ¼ç›" }, { word: "HAIR", hint: "é ­é«®" }, { word: "LITTLE", hint: "å°çš„" }, { word: "LONG", hint: "é•·çš„" }, { word: "MOUTH", hint: "å˜´å·´" }, { word: "NOSE", hint: "é¼»å­" }, { word: "NOW", hint: "ç¾åœ¨" }, { word: "SHORT", hint: "çŸ­çš„/çŸ®çš„" }],
                "U3": [{ word: "COAT", hint: "å¤–å¥—" }, { word: "DRESS", hint: "æ´‹è£" }, { word: "GLASSES", hint: "çœ¼é¡" }, { word: "PANTS", hint: "è¤²å­" }, { word: "SHIRT", hint: "è¥¯è¡«" }, { word: "SHOES", hint: "é‹å­" }, { word: "SHORTS", hint: "çŸ­è¤²" }, { word: "SKIRT", hint: "è£™å­" }, { word: "SOCKS", hint: "è¥ªå­" }, { word: "SWEATER", hint: "æ¯›è¡£" }],
                "U4": [{ word: "TIRED", hint: "ç´¯çš„" }, { word: "HAPPY", hint: "å¿«æ¨‚çš„" }, { word: "SAD", hint: "æ‚²å‚·çš„" }, { word: "BORED", hint: "ç„¡èŠçš„" }, { word: "ANGRY", hint: "ç”Ÿæ°£çš„" }, { word: "CRAZY", hint: "ç˜‹ç‹‚çš„" }, { word: "HUNGRY", hint: "é£¢é¤“çš„" }, { word: "THIRSTY", hint: "å£æ¸´çš„" }, { word: "SICK", hint: "ç”Ÿç—…çš„" }, { word: "SCARED", hint: "å®³æ€•çš„" }],
                "U5": [{ word: "MONTH", hint: "æœˆä»½" }, { word: "JANUARY", hint: "ä¸€æœˆ" }, { word: "FEBRUARY", hint: "äºŒæœˆ" }, { word: "MARCH", hint: "ä¸‰æœˆ" }, { word: "APRIL", hint: "å››æœˆ" }, { word: "MAY", hint: "äº”æœˆ" }, { word: "JUNE", hint: "å…­æœˆ" }, { word: "JULY", hint: "ä¸ƒæœˆ" }, { word: "AUGUST", hint: "å…«æœˆ" }, { word: "SEPTEMBER", hint: "ä¹æœˆ" }, { word: "OCTOBER", hint: "åæœˆ" }, { word: "NOVEMBER", hint: "åä¸€æœˆ" }, { word: "DECEMBER", hint: "åäºŒæœˆ" }]
            }
        };

        // éŠæˆ²ç‹€æ…‹è®Šæ•¸
        let currentWord = "";
        let currentSpelling = [];
        let currentWordList = [];
        let wordIndex = 0;
        let errorList = [];
        let isReviewMode = false;
        let currentGrade = null; 
        let selectedUnits = []; 
        const keys = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split('');
        
        // DOM å…ƒç´ 
        const hintDisplay = document.getElementById('hint-display');
        const reviewStatus = document.getElementById('review-status');
        const gradeButtonsContainer = document.getElementById('grade-buttons-container'); 
        const unitButtonsContainer = document.getElementById('unit-buttons-container'); 
        const inputArea = document.getElementById('input-area');
        const startBtn = document.getElementById('start-btn');
        const repeatBtn = document.getElementById('repeat-btn');
        const checkBtn = document.getElementById('check-btn');
        const answerBtn = document.getElementById('answer-btn');
        const feedbackMessage = document.getElementById('feedback-message');

        // èªéŸ³åˆæˆç‰©ä»¶
        const synth = window.speechSynthesis;
        let englishVoice = null;

        // --- é¸æ“‡å™¨èˆ‡å–®å­—è¼‰å…¥ ---
        
        /**
         * è™•ç†å¹´ç´šæŒ‰éˆ•é»æ“Šäº‹ä»¶ (å¾ HTML onclick èª¿ç”¨)
         */
        function selectGrade(clickedButton) {
            const grade = clickedButton.dataset.grade;
            
            // è¦–è¦ºæ•ˆæœï¼šæ¸…é™¤æ‰€æœ‰å¹´ç´šæŒ‰éˆ•çš„é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('.grade-btn').forEach(btn => btn.classList.remove('selected'));
            
            // è¨­ç½®ç•¶å‰å¹´ç´šä¸¦é«˜äº®
            currentGrade = grade;
            clickedButton.classList.add('selected');
            
            // è¼‰å…¥è©²å¹´ç´šçš„å–®å…ƒæŒ‰éˆ•
            loadUnits(currentGrade);
        }

        /**
         * è¼‰å…¥å–®å…ƒæŒ‰éˆ•
         */
        function loadUnits(grade) {
            unitButtonsContainer.innerHTML = '';
            selectedUnits = []; 
            
            if (grade && allWordUnits[grade]) {
                const units = allWordUnits[grade];
                Object.keys(units).forEach(unit => {
                    const button = document.createElement('button');
                    button.className = 'unit-btn';
                    button.textContent = `${unit} (${units[unit].length})`;
                    button.dataset.unit = unit; 
                    button.onclick = toggleUnitSelection; 
                    unitButtonsContainer.appendChild(button);
                });
            } else {
                 unitButtonsContainer.innerHTML = 'è«‹å…ˆé¸æ“‡å¹´ç´š';
            }
            checkSelectionStatus();
        }

        /**
         * é»æ“ŠæŒ‰éˆ•åˆ‡æ›å–®å…ƒé¸ä¸­ç‹€æ…‹
         */
        function toggleUnitSelection() {
            const unit = this.dataset.unit;
            const index = selectedUnits.indexOf(unit);

            if (index > -1) {
                // å·²é¸ä¸­ -> å–æ¶ˆé¸ä¸­
                selectedUnits.splice(index, 1);
                this.classList.remove('selected');
            } else {
                // æœªé¸ä¸­ -> é¸ä¸­
                selectedUnits.push(unit);
                this.classList.add('selected');
            }
            checkSelectionStatus();
        }

        /**
         * æª¢æŸ¥æ˜¯å¦æœ‰å–®å…ƒè¢«é¸ä¸­ï¼Œæ±ºå®šæ˜¯å¦å•Ÿç”¨é–‹å§‹æŒ‰éˆ•
         */
        function checkSelectionStatus() {
            if (currentGrade && selectedUnits.length > 0) {
                startBtn.disabled = false;
                hintDisplay.textContent = `å·²é¸æ“‡ ${currentGrade} çš„ ${selectedUnits.length} å€‹å–®å…ƒï¼Œé»æ“Šé–‹å§‹éŠæˆ²ï¼`;
            } else if (currentGrade) {
                startBtn.disabled = true;
                hintDisplay.textContent = 'è«‹é¸æ“‡è¦ç·´ç¿’çš„èª²åˆ¥ï¼';
            } else {
                startBtn.disabled = true;
                hintDisplay.textContent = 'è«‹å…ˆé¸æ“‡å¹´ç´šï¼';
            }
        }
        
        // --- éŠæˆ²é‚è¼¯å‡½æ•¸ (èˆ‡å‰ä¸€å€‹ç‰ˆæœ¬ç›¸åŒ) ---
        
        function setEnglishVoice() {
            if (englishVoice) return;
            const voices = synth.getVoices();
            englishVoice = voices.find(voice => voice.lang.startsWith('en-US') || voice.lang.startsWith('en-GB'));
        }
        synth.onvoiceschanged = setEnglishVoice;
        
        function speak(text, rate = 0.9) {
            if (synth.speaking) {
                synth.cancel();
            }
            setEnglishVoice();
            const utterThis = new SpeechSynthesisUtterance(text);
            utterThis.voice = englishVoice;
            utterThis.lang = 'en-US'; 
            utterThis.rate = rate; 
            synth.speak(utterThis);
            return utterThis;
        }

        function readWord(word) {
            repeatBtn.disabled = true; 
            const utterThis = speak(word, 0.7); 
            utterThis.onend = () => {
                repeatBtn.disabled = false;
            };
        }
        
        /**
         * å•Ÿå‹•/é‡å•ŸéŠæˆ²æˆ–è¤‡ç¿’æ¨¡å¼
         */
        function startGame() {
            if (!isReviewMode) {
                if (!currentGrade || selectedUnits.length === 0) {
                    hintDisplay.textContent = 'è«‹å…ˆé¸æ“‡å¹´ç´šå’Œèª²åˆ¥ï¼';
                    return;
                }
                
                currentWordList = [];
                errorList = [];
                selectedUnits.forEach(unit => {
                    currentWordList = currentWordList.concat(allWordUnits[currentGrade][unit]);
                });

                currentWordList.sort(() => Math.random() - 0.5); 
                wordIndex = 0;
            } else if (errorList.length > 0) {
                currentWordList = [...errorList];
                wordIndex = 0;
                errorList = [];
            } else {
                endGame();
                return;
            }
            
            reviewStatus.textContent = isReviewMode ? 
                `ğŸ”´ éŒ¯èª¤è¤‡ç¿’æ¨¡å¼ï¼šå…± ${currentWordList.length} é¡Œ` : ``;

            checkBtn.disabled = true;
            answerBtn.disabled = false;
            startBtn.textContent = 'ä¸‹ä¸€å€‹å–®å­—';
            
            loadNextWord();
        }

        /**
         * è¼‰å…¥ä¸‹ä¸€çµ„å–®å­—
         */
        function loadNextWord() {
            if (wordIndex >= currentWordList.length) {
                if (errorList.length > 0) {
                    isReviewMode = true;
                    setTimeout(() => {
                        const totalErrors = errorList.length;
                        if (confirm(`ğŸ‰ æœ¬è¼ªå®Œæˆï¼æ‚¨æœ‰ ${totalErrors} å€‹å–®å­—éœ€è¦è¤‡ç¿’ã€‚ç¾åœ¨é–‹å§‹è¤‡ç¿’å—ï¼Ÿ`)) {
                            startGame();
                        } else {
                            endGame();
                        }
                    }, 500);
                } else {
                    endGame();
                }
                return;
            }
            
            const wordData = currentWordList[wordIndex];
            currentWord = wordData.word;
            currentSpelling = [];
            
            inputArea.innerHTML = '';
            feedbackMessage.textContent = '';
            
            const unitInfo = isReviewMode ? "è¤‡ç¿’é¡Œ" : `ç¬¬ ${wordIndex + 1}/${currentWordList.length} é¡Œ`;
            hintDisplay.textContent = `[${unitInfo}] ${wordData.hint}`;

            for (let i = 0; i < currentWord.length; i++) {
                const slot = document.createElement('div');
                slot.className = 'letter-slot';
                slot.id = `slot-${i}`;
                inputArea.appendChild(slot);
            }

            readWord(currentWord);
        }

        function endGame() {
            isReviewMode = false;
            currentWordList = [];
            wordIndex = 0;
            errorList = [];
            inputArea.innerHTML = '';
            checkBtn.disabled = true;
            answerBtn.disabled = true;
            repeatBtn.disabled = true;
            reviewStatus.textContent = '';
            startBtn.textContent = 'é‡æ–°é–‹å§‹';
            
            hintDisplay.textContent = 'ğŸ‘ æ­å–œæ‚¨ï¼æ‰€æœ‰å–®å­—æ¸¬é©—å’Œè¤‡ç¿’éƒ½å·²å®Œæˆï¼';
            feedbackMessage.textContent = 'è«‹é¸æ“‡æ–°çš„å–®å…ƒé–‹å§‹ä¸‹ä¸€è¼ªç·´ç¿’ã€‚';
        }

        function handleKeyClick(letter) {
            if (currentWord === "") return;
            if (currentSpelling.length < currentWord.length) {
                currentSpelling.push(letter);
                const currentSlot = document.getElementById(`slot-${currentSpelling.length - 1}`);
                currentSlot.textContent = letter;
            }
            if (currentSpelling.length === currentWord.length) {
                checkBtn.disabled = false;
            }
        }

        function checkSpelling() {
            checkBtn.disabled = true;
            repeatBtn.disabled = true;
            answerBtn.disabled = true; 
            
            const playerWord = currentSpelling.join('');

            if (playerWord === currentWord) {
                feedbackMessage.textContent = 'ğŸ¥³ å¤ªæ£’äº†ï¼æ‹¼å¯«å®Œå…¨æ­£ç¢ºï¼';
                speak('Excellent! The word is ' + currentWord, 1.0);
                
                for (let i = 0; i < currentWord.length; i++) {
                    document.getElementById(`slot-${i}`).classList.add('correct');
                }
                
                wordIndex++;
                setTimeout(loadNextWord, 3000);
            } else {
                feedbackMessage.textContent = 'ğŸ’¡ éŒ¯å›‰ï¼è«‹å†è½ä¸€æ¬¡æˆ–æŸ¥çœ‹ç­”æ¡ˆã€‚';
                
                for (let i = 0; i < currentWord.length; i++) {
                    const slot = document.getElementById(`slot-${i}`);
                    if (currentSpelling[i] && currentSpelling[i] === currentWord[i]) {
                        slot.classList.add('correct');
                    } else {
                        slot.classList.add('incorrect');
                    }
                }
                
                const currentWordData = currentWordList[wordIndex];
                if (!errorList.find(w => w.word === currentWordData.word)) {
                    errorList.push(currentWordData);
                }
                
                setTimeout(() => speak('Try again! Listen carefully.'), 500); 
                answerBtn.disabled = false;
                setTimeout(resetForRetry, 3000);
            }
        }
        
        function resetForRetry() {
            feedbackMessage.textContent = 'è«‹å†è©¦ä¸€æ¬¡ï¼é»æ“Šå­—æ¯é‡æ–°è¼¸å…¥ã€‚';
            currentSpelling = [];
            
            for (let i = 0; i < currentWord.length; i++) {
                const slot = document.getElementById(`slot-${i}`);
                slot.textContent = '';
                slot.classList.remove('correct', 'incorrect', 'skipped');
            }
            repeatBtn.disabled = false;
        }

        function showAnswer() {
            const word = currentWord;
            
            for (let i = 0; i < word.length; i++) {
                const slot = document.getElementById(`slot-${i}`);
                slot.textContent = word[i];
                slot.classList.add('skipped');
            }
            
            feedbackMessage.textContent = `ç­”æ¡ˆæ˜¯ ${word}ã€‚é€™å€‹å–®å­—å·²åŠ å…¥å¾…è¤‡ç¿’æ¸…å–®ï¼`;
            speak(`The correct word is ${word}`);
            
            const currentWordData = currentWordList[wordIndex];
            if (!errorList.find(w => w.word === currentWordData.word)) {
                 errorList.push(currentWordData);
            }
            
            wordIndex++;
            checkBtn.disabled = true;
            answerBtn.disabled = true;
            
            setTimeout(loadNextWord, 3000);
        }


        // --- åˆå§‹åŒ– ---
        function createKeyboard() {
            const keyboardDiv = document.getElementById('keyboard');
            keys.forEach(letter => {
                const keyBtn = document.createElement('button');
                keyBtn.className = 'key';
                keyBtn.textContent = letter;
                keyBtn.onclick = () => handleKeyClick(letter);
                keyboardDiv.appendChild(keyBtn);
            });
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        window.onload = function() {
            createKeyboard();
            // ç„¡éœ€ initializeSelectorsï¼Œå› ç‚ºå¹´ç´šæŒ‰éˆ•å·²åœ¨ HTML ä¸­
            checkSelectionStatus(); // ç¢ºä¿é–‹å§‹æŒ‰éˆ•åˆå§‹æ˜¯ç¦ç”¨çš„
        };
        
        repeatBtn.onclick = () => readWord(currentWord); 
        checkBtn.onclick = checkSpelling;
        
    </script>

</body>
</html>
